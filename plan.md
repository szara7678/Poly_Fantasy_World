1. 게임 개요
가제: 성자의 영토 (Saint’s Dominion)

장르: 실시간 콜로니 시뮬 + 라이트 RPG + 생존/건설

렌더/플랫폼: Three.js(WebGL) / GitHub Pages 배포 대상

핵심 판정:

성자는 불멸이지만 전투력은 낮음. 성역화로 영토를 창건/확장, 건물은 성역 내부에만 건설 가능.

몬스터는 성역 내부로 진입 불가(경계 관통 원거리 피해 −50%).

**시민(엔티티)**는 자율 AI로 영역 지정·건설·직업 선택·우선순위를 결정. 플레이어는 **전언(Edict)**과 타겟 지시로 큰 방향만 제어.

자원 노드는 최대량/일일 재생량을 가지며, 채집 건물 없이 인력이 직접 채집 후 가공.

성역 밖에서는 도로만 건설 가능(이동속도 향상).

상인/경제/무역으로 적자 품목을 교역, 잉여를 판매.

2. 핵심 루프
탐사(안개 해제) → 성역화로 거점 확보 → 시민 자율 채집/건설/제작/연구 → 상인 교역/도로로 물류 최적화 → 레이드/보스 대응(영웅+성자 기적) → 위성 마을 창건 → 고급 연구·룬·마나공학 → 승리 목표 달성.

3. 월드·안개·바이옴
안개(FoW):

상태: Unseen/Explored/Visible

성역 내부: 항상 Visible

정찰·사냥꾼·벌목꾼·상인이 다닌 경로 중심 폭 812m가 Explored로 누적(510분 후 일부 퇴색)

정찰 임무: 30초마다 부채꼴 25m Visible 스윕

바이옴 예: 초원/침엽수림/산악/사막/늪/화산/마나황무지 (난이도·자원/위협 테이블 상이)

4. 성자·성역(영토)
기적: 성역화(Consecrate)

마나 180, 시전 6초, 쿨다운 180초

반경 18m × (성소 레벨+1) (초기 36m) 원형 성역 생성/확장

유지비: 성역 1개당 −0.2 마나/s (정착지 신앙 총합/100만큼 상쇄)

상한: 동시 2개(연구로 +1, +1)

안전: 성역 내 몬스터 진입 불가. 경계 관통 원거리/광역 피해 −50%

건설 규칙: 성역 내부만 모든 건축 가능, 성역 밖은 도로만 건설 가능

위성 마을:

성자+개척대(5~12명) 캐러밴 이동 → 성역화 → 성소/창고/주거 자동 청사진 → 자율 정착

본거지와 도로 연결 시 물류·교역·방어 효율 상승

5. 자원 노드·채집
노드 모델(예시):

숲(Forest): capMax 1000, regen +2/일, 벌목 1~3통/행동

철광산(IronMine): capMax 1000, regen +1/일, 광석 1/행동

약초지(HerbPatch): capMax 300, regen +3/일

마나원(ManaSpring): capMax 200, regen +0.5/일(정제 필요)

안전 저수준(SafeReserve): capMax의 20%는 보존, 그 이하로 내려가면 하루 쿼터 축소/중지

일일 쿼터: min( capNow - SafeReserve , 가용 인력×작업률 )만큼 벌목/채광 작업 청크 자동 발행

채집 건물 없음: 인력이 직접 캐서 창고 → 가공시설로 투입(제재소/제련/공방 등)

6. 도로(성역 밖 건설 유일)
타입	비용(타일)	속도계수	특기
흙길	노역	×1.25	어디든, 비 후 ×1.15
자갈길	돌×1	×1.40	경사<30°
판잣길(습지)	목재×1	×1.35	습지 특화
석판로	돌×2	×1.55	평탄 필요, 내구 최고

내구 소모 → 보수 태스크 자동 생성

자동 도로 플래너(선택): 성소/창고 ↔ 빈발 노드/위성 마을/시장 간 흐름/길이/안전/지형 점수로 노선 제안

7. 시민·직업·자율 AI
스탯: STR/DEX/INT/VIT/WIS/CHA(020, 평균 810)

파생: HP=50+VIT×10, Stamina=50+(STR+DEX)×5, Mana=30+(INT+WIS)×8

적성(★0~3): 채집/벌목/채광/사냥/농사/목축/공예/대장/건축/연금/치유/연구/전투

특성: 근면/겁쟁이/신실/야행성/손재주/불굴 등(±5~15%)

역할: 벌목꾼/광부/사냥꾼/농부/건축가/대장장이/연금술사/치유사/연구자/경비병/상인

자율 의사결정(핵심):

markdown
복사
편집
작업 점수 = Base × Aptitude × Context × Distance × Risk × Edict × Need × Facility × Fatigue
           + TargetOrder
Base: 작업 기본 매력도(건설1.2/전투1.3/채집1.0/연구0.9 등)

Aptitude: 1+0.25×★ + (관련 스탯−10)/40

Context: 전시/흉년/부상/경제(가격·재고) 반영

Distance: 1/(1+d/R) (R: 작업별 기준거리)

Risk: 1−clamp(위험×취약,0,0.6)

Edict: 전언 가중(1.1~2.0, 총합×3 캡)

Need: (소비−생산)/소비 (부족 품목↑)

Facility: 관련 건물 포화/레벨/인접 보너스

Fatigue: 생리/사기 보정(0.5~1.0)

TargetOrder: 플레이어 하드 지시 가산(+0.8~+1.5)

직업 자동 결정: 현 역할보다 +20% 이상 높은 역할 점수가 2분 연속 유지 시 전직

작업 예약: Job Chunk에 슬롯 선점(타임아웃/반납 포함)

전시 체제: 위협>0.6 → 전투·방어 가중↑, 비전투↓, 방어 건물 우선

8. 전언(Edict)·타겟 지시
전언: 분야/태그로 가중치 곱:

채집/마나석, 채집/철광산, 채집/숲

전투/늑대, 전투/트롤, 전투/언데드

건설/시장, 건설/교역소, 건설/도로, 건설/대장간

연구/룬학, 연구/금속공

무역/식량, 무역/철괴 … (지속·감쇠·TTL)

타겟 지시: 특정 몬스터/노드/지점에 하드 오더(만료/실패 규칙, 우선권 최고)

9. 영웅·성자·전투
영웅 듀오: 높은 기본치+시너지(수호/사냥형), 탱/원/마/드루 혼합

성자 기적(발췌):

성역(범위 보호/면역), 치유의 파동, 정화, 시간 완화, 수호정령 소환, 영혼 귀환, 성역화

피해 타입: 참/관통/둔기, 화염/빙결/전기/독/신성/암흑/비전

상성 예: 둔기→골렘/갑주 강, 신성→언데드 강, 화염→식물 강(빙결 약)

10. 몬스터
분류: 야수(늑대/곰), 요마(고블린/트롤), 원소(정령), 언데드(해골/망령), 마나 변이(포식자/수정 골렘)

등급: 일반/정예/보스 (HP/공격/특수/드랍 차등)

규칙: 성역 내부 진입 불가, 경계 밖에서의 공격은 성역 관통 페널티 적용

AI: 위협도 기반 타겟팅, 보스 페이즈 전환

11. 건물(성역 내부 전용) & 생산
핵심: 성소, 주거, 창고, 제재소, 제련소, 공방, 대장간, 연금실, 연구실, 병영/사격장/마탑, 시장/교역소, 성벽/탑

인접 보너스: 창고·도로·성소 근접 시 생산·이동 효율↑

업그레이드: Lv1~3(슬롯/속도/품질/수수료 개선)

건설 자동 우선순위 점수(발췌):

makefile
복사
편집
BScore = CapacityDeficit + ProductionDeficit + WarFooting + Synergy
       + DistancePenalty + ResourceFeasibility + EdictBuild
(임계 초과 시 자율 청사진 생성)

12. 아이템/티어/룬
티어: 돌 → 청동 → 철 → 강철 → 마나합금

도구: 도끼/곡괭이/톱/망치/괭이/부삽/낫/등불/수레

무기/방어: 검/창/도끼/곤봉/활/쇠뇌/지팡이, 천/가죽/사슬/판금/로브/방패

룬: 화염/빙결/전기/신성/비전 각인(공격/내성/자원 효율 보정)

13. 경제·상인·무역
화폐: Coin(금고)

시장(Market): 매수/매도 계약(수량·상/하한가·기한), 수수료 5%(업글 3%)

교역소(Tradepost): 캐러밴 파견/접수, 거래 한도 보너스

가격:

ini
복사
편집
SettlementPrice = BasePrice × (1 + Scarcity)
Scarcity = clamp((Desired - Current)/Desired, -0.4, +1.0)
상인 역할: 노선 점수 = 예상이익 − 위험비용 − 시간비용 (전언: 무역/품목 가중)

캐러밴: 상인1+운반1~4+노새/수레(+경비), 도로 계수 적용

14. 진행·연구·이벤트
연구: 생존→농업→금속→군사→마법→문명→고대기술(성역 상한/반경↑, 마나 유지 효율↑)

시즌: 봄/여름/가을/겨울(생산/소비 보정)

이벤트: 마나폭풍/역병/순례/도적단/레이드/유적

15. 밸런싱 기본값(초안)
성역: 반경 36m(Lv1), 유지 −0.2 마나/s/성역, 상한 2개

도로 속도: 1.25/1.40/1.35/1.55 (흙/자갈/판자/석판)

노드: 숲 1000(+2/일), 철 1000(+1/일), 안전저수준 20%

자원 속도: 벌목 1통/8s, 채광 1광석/10s, 운반 1통/3s(거리 보정)

전투 TTK: 초반 일반몹 6~10s(영웅1+경비2 기준)

전시 임계: 위협>0.6 (해제<0.4)

전언 상한: 모든 곱 총합 ×3.0

전직 히스테리시스: +20%/120초

16. 데이터 스키마(샘플)
json
복사
편집
// 성역
{ "sanctumId":"S_home","center":[0,0,0],"radius":36,
  "upkeepManaPerSec":0.2,"noMonsterEntry":true,"rangedMitigation":0.5 }

// 성역화 주문
{ "spellId":"Consecrate","manaCost":180,"castTime":6,"cooldown":180,
  "radiusPerLevel":18,"upkeepPerSanctum":0.2,"maxSanctums":2 }

// 자원 노드
{ "nodeId":"iron_i07","type":"IronMine","capMax":1000,"capNow":612,"regenPerDay":1 }

// 도로
{ "roadId":"r_17","type":"Stone","from":[0,0,0],"to":[620,0,440],"len":760 }

// 거래 계약
{ "contractId":"sell_leather_80","kind":"Sell","item":"Leather",
  "qty":80,"limitPrice":3,"expiresDay":31,"status":"Open" }

// 작업 청크(채집)
{ "jobChunkId":"Gather_iron_i07_04","type":"Gather","resource":"IronOre",
  "pos":[618,0,438],"nodeId":"iron_i07","slots":3,"danger":0.12 }

// 전언
{ "id":"edict_Gather_Iron","domain":"Gather","tag":"IronMine",
  "mult":1.6,"ttl":600,"decay":0.996 }
17. 시스템 설계 간단 의사코드
ts
복사
편집
// 일일 노드 재생 & 쿼터
for (node of nodes) {
  node.capNow = clamp(node.capNow + node.regenPerDay*daysElapsed, 0, node.capMax);
  if (node.capNow > node.capMax*0.2) spawnGatherJobs(node); // SafeReserve
}

// 건설 가능 판정
function canBuild(pos, type){
  if (type === "Road") return true;                // 어디든 도로 OK
  return isInsideAnySanctum(pos);                  // 그 외는 성역 내부만
}

// 시민 의사결정(요약)
candidates = senseJobs(entity);
for (t of candidates) t.u = score(entity, t, blackboard); // 점수식
best = argmax(candidates, x=>x.u);
if (reserve(best)) assign(entity,best);
18. UI/UX
전언 패널: 분야 탭(채집/전투/건설/연구/무역/성역) + 태그 검색 + 강도/지속 슬라이더, 현재 전언 리스트(감쇠/잔여)

타겟 지시: 대상 클릭→“타겟” 버튼(위험·요구 역할 미리보기)

성역 패널: 현 성역 반경/유지비/신앙 상쇄, 확장 버튼(미리보기)

도로 도우미: 추천 노선 표시(점수), 수락 시 청사진 생성

우선순위 디버거: 엔티티 선택 시 Top-5 작업과 가중 항목 바차트

19. 기술 스택·배포
렌더/물리: Three.js + Rapier(CPU/WASM) 또는 cannon-es

아키텍처: ECS(bitecs/ecsy) + BT/Utility AI + Recast/Detour(navmesh)

번들: Vite (base:'/repo-name/'로 GH Pages 호환)

자원: glTF 로우폴리, 텍스처 512~1024, 오브젝트 풀/LOD

배포: dist/를 gh-pages 브랜치 푸시

20. 프로토타입 로드맵(4 스프린트)
성역화/건설/자원 노드/도로 + 자율 AI 기본 루프

전언/타겟/위협-전시 + 영웅·성자 핵심 기적 2~3종

시장/교역소/상인/캐러밴 + 가격·계약·무역 루프

보스 1종/레이드/연구·룬 + 튜토리얼/밸런스 곡선 + 저장/로드

필요하면 이 기획을 바로 **데이터 팩(JSON)**과 **ECS 시스템 뼈대(TypeScript)**로 쪼개서 줄게(예: SanctumSystem, FogOfWarSystem, NodeRegenSystem, RoadPlannerSystem, TradeSystem, EdictSystem). 다음 단계로 데이터 스키마 파일들부터 만들어줄까, 아니면 ECS 코드 템플릿부터 갈까?









0. 준비(3~5일)
목표: 깃허브 페이지로 배포 가능한 기본 뼈대와 품질/성능 가드레일 세팅
해야 할 일

Vite + TypeScript + ESLint/Prettier + Vitest 세팅, base:'/repo-name/'

ECS(bitecs) 골격, 시스템 루프/고정틱(30–60Hz) vs 렌더틱 분리

Three.js 씬/카메라/조명/프리패브 로더(glTF)

GitHub Actions: main → build → gh-pages 자동 배포

디버그 패널(프레임, 드로콜, 삼각형 수, 메모리, AI틱 시간)

성능 예산: 60fps@1080p, DrawCalls<400, Tris<200k, 텍스처 <256MB

DoD

https://username.github.io/repo-name/ 에 빈 씬+UI 패널이 뜬다

CI 성공, ESLint/타입체크 통과

1 스프린트: 월드·안개·카메라(2주)
목표: **안개(FoW)**와 기본 월드가 돌아간다
구현

타일/청크 월드, 높이/바이옴 샘플러(간단 노이즈)

FoW: Unseen/Explored/Visible 텍스처 기반 셰이딩

시야 소스: 성역 내부 상시 Visible, 정찰자/사냥꾼/벌목꾼/상인 경로 폭 8~12m로 Explored 누적(시간 경과 퇴색)

카메라(줌/회전), 선택/하이라이트, 기본 UI 프레임

DoD

시작 지점만 보이고, 정찰자 이동에 따라 지도가 드러남

브라우저 새로고침 후 기본 설정 유지(로컬 저장)

2 스프린트: 성자·성역·건설 규칙(2주)
목표: **성역화(Consecrate)**와 “성역 안에서만 건설” 규칙 확립
구현

성자 엔티티/마나/기적 캐스팅, Consecrate(mana180, cast6s, cd180s)

성역 데이터(중심/반경/유지비) + 몬스터 진입 금지/경계 관통 피해 −50%

건설 시스템: 성역 내부만 건물 배치 허용, 성역 밖은 도로만 허용

기본 건물 3종(성소/창고/주거) 배치/철거/업그레이드

위성 성역(최대 2개) 생성 및 유지비(신앙 상쇄) 로직

DoD

성역 반경 미리보기/확장 성공, 성역 밖 건물 배치 거부

몬스터가 성역 경계 밖에서 쏜 투사체 피해 반감 적용

3 스프린트: 자원 노드·채집·도로(2주)
목표: 채집 건물 없이 노드→사람이 캐서→가공 루프 완성
구현

노드 모델(숲 capMax1000 regen+2/일, 철광 capMax1000 regen+1/일 등)

일일 재생/안전저수준(20%) & 일일 쿼터로 작업 청크 발행

벌목/채광/운반 애니메이션 루틴, 창고 입출고

도로 4종(흙/자갈/판자/석판), 이동속도 계수 적용 & 보수 태스크

자동 도로 플래너(선택): 성소/창고↔노드 흐름 기반 노선 추천

DoD

숲/철광 쿼터대로 자동 채집·운반되고 수치가 줄었다가 매일 재생

도로 깔면 캐러밴/시민 이동속도가 눈에 띄게 빨라짐

4 스프린트: 자율 AI·전언/타겟·직업(2주)
목표: 플레이어는 방향만, 시민은 스스로 결정
구현

전역 블랙보드: 재고/생산·소비/위협/작업큐/전언/하드타겟

유틸리티 점수식: Base×Aptitude×Context×Distance×Risk×Edict×Need×Facility×Fatigue + TargetOrder

작업 예약/슬롯/타임아웃, 히스테리시스(작업 흔들림 방지)

전언 패널: 분야/태그/강도/TTL, 감쇠

타겟 지시: 특정 몬스터/노드/지점 하드 오더

역할 자동 결정/전직(+20%/2분 규칙)

DoD

전언 “채집/마나석” 넣으면 채광 우선이 즉시 눈에 띄게 변함

타겟 “전투/늑대” 주면 경비/영웅이 먼저 출동

5 스프린트: 전투·영웅·성역 방어(2주)
목표: 최소 전투 루프 & 성역 방어 상호작용
구현

영웅 듀오(탱/원/마 중 2), 기본 스킬 2~3개

몬스터 3계열(야수/요마/언데드) + 정예 1, 간단 레이드 웨이브

피해 타입/저항/상태이상(출혈/화상/서리) 기초

성역 내/외 전투 처리 차이, 전시 체제(위협>0.6)

성자의 기적 2종 추가(치유의 파동/정화)

DoD

야간 레이드에서 성역 경계 효과가 제대로 작동, TTK 목표 충족

영웅이 시민을 보호하고 보스 미니 이벤트 1회 클리어 가능

6 스프린트: 경제·상인·무역(2주)
목표: 시장/교역소/캐러밴으로 적자 품목을 메운다
구현

금고(Coin), SettlementPrice = Base×(1+Scarcity) 수요·공급 변동

시장(Market): 매수/매도 계약(수량/상·하한가/기한), 수수료 5%

교역소(Tradepost): 캐러밴 파견/접수, 노선 선택(이익−위험−시간)

상인 역할/운반수/노새/경비 자동 편성, 도로 계수 적용

전언: 무역/철괴, 무역/식량, 건설/시장, 건설/교역소

DoD

식량/철괴 부족 시 계약이 체결되고 캐러밴이 다녀와 재고가 회복

정산 로그/거래 내역 UI에서 가격/수수료 확인 가능

7 스프린트: UX·세이브/로드·튜토리얼·폴리시(2주)
목표: 누구나 플레이 가능한 품질선까지 끌어올리기
구현

세이브/로드(버전드 스냅샷; 노드/성역/도로/전언/재고/AI상태 포함)

튜토리얼: 성역화→건설→채집→도로→전언→전투→무역 흐름

접근성: 색약 모드, UI 스케일, 일시정지/가속, 키 바인딩

성능 튜닝: 오브젝트 풀, Instancing, LOD, Occlusion/Frustum Culling

오디오: BGM 루프 1, SFX 기본(채집/전투/UI), 볼륨 믹서

DoD

첫 실행튜토리얼2시간 플레이가 무리 없이 가능, 1080p 60fps 유지

GH Pages “베타 공개” 링크와 릴리스 노트 배포

공통 작업 스트림(스프린트 전반에 병행)
데이터 팩: biomes.json, nodes.json, buildings.json, items.json, skills.json, edicts.json, contracts.json

테스트

단위: 노드 재생/쿼터, 전언 감쇠, 가격 계산, 성역 충돌/피해 반감

통합: 작업 예약 경합, 전시 전환 히스테리시스, 세이브/로드 무결성

플레이: 20·60·120분 시나리오(“굶주림 없이 생존”, “레이드 2회 방어”, “위성 성역 창건”)

밸런스 텔레메트리: 생산–소비 그래프, 전언 사용 빈도, 캐러밴 이익, 전투 TTK, 프레임타임/AI틱

아트 파이프라인: 로우폴리(캐릭 800–1.5k tris, 건물 1–3k), 텍스처 512~1k, 애니 12–24fps, 아틀라스화

위험요소 & 대응
경로탐색 성능: Recast/Detour + 네브메시 구역화, 군중 이동은 steering으로 단순화

AI 스파이크: 유틸리티 캐시/증분 업데이트, 엔티티 평가 분산

웹 메모리/GC: 오브젝트 풀, 컴포넌트 SoA, glTF 재사용, 오디오/텍스처 해제

경제 붕괴: 가격 상한/하한, 계약 만료/패널티, 초기 비축치 보정

난이도 폭주: 레이드 히스테리시스(해제<0.4), 성역 내 세이프존 보장

파일/모듈 구조(요약)
bash
복사
편집
/src
  /ecs /systems /components /ai /render /ui /data
  systems/
    SanctumSystem.ts, FogOfWarSystem.ts, NodeRegenSystem.ts
    JobPlannerSystem.ts, EdictSystem.ts, RoleSystem.ts, ReservationSystem.ts
    RoadPlannerSystem.ts, TradeSystem.ts, CombatSystem.ts, SaveLoadSystem.ts
  ui/
    EdictPanel.tsx, TargetPanel.tsx, SanctumPanel.tsx, MarketPanel.tsx, RoadHelper.tsx
/data (json 템플릿들)
/assets (gltf, textures, sfx)
vite.config.ts
마일스톤 요약 & 체크리스트
M1(MVP 루프): 성역화, 성역 내 건설, 노드 채집/가공, 도로, 전언/타겟 ✅

M2(전투/방어): 영웅/몬스터/레이드, 성역 방어 규칙, 전시 체제 ✅

M3(경제/무역): 시장/교역소/캐러밴/가격/계약 ✅

M4(출시 준비): 튜토리얼/세이브/성능/오디오/베타 배포 ✅